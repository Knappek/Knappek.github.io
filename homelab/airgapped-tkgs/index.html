
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://knappek.github.io/homelab/airgapped-tkgs/">
      
      
        <link rel="prev" href="../">
      
      
        <link rel="next" href="../../misc/hello-world-apps/">
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.0, mkdocs-material-9.5.27">
    
    
      
        <title>Airgapped TKGS homelab environment - Andy's Technical Scratchpad</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.6543a935.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  

<script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-0VCFRTY9ME"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-0VCFRTY9ME",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-0VCFRTY9ME",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>
  
    <script>var consent;"undefined"==typeof __md_analytics||(consent=__md_get("__consent"))&&consent.analytics&&__md_analytics()</script>
  

    
    
    
   <link href="../../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
    html.glightbox-open { overflow: initial; height: 100%; }
    .gslide-title { margin-top: 0px; user-select: text; }
    .gslide-desc { color: #666; user-select: text; }
    .gslide-image img { background: white; }
    .gscrollbar-fixer { padding-right: 15px; }
    .gdesc-inner { font-size: 0.75rem; }
    body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
    body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
    body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}</style> <script src="../../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#set-up-an-airgapped-tkgs-homelab-environment" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow md-header--lifted" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Andy&#39;s Technical Scratchpad" class="md-header__button md-logo" aria-label="Andy's Technical Scratchpad" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Andy's Technical Scratchpad
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Airgapped TKGS homelab environment
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Knappek/Knappek.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Knappek/Knappek.github.io
  </div>
</a>
      </div>
    
  </nav>
  
    
      
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
    <li class="md-tabs__item">
      <a href="../.." class="md-tabs__link">
        
  
    
  
  Home

      </a>
    </li>
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../kubernetes/architecture-concepts/" class="md-tabs__link">
          
  
    
  
  Kubernetes

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../tanzu/tkgs/tkgs-nsxt-integration/" class="md-tabs__link">
          
  
    
  
  Tanzu

        </a>
      </li>
    
  

    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../observability/write-k8s-audit-logs-to-loki-grafana-cloud/" class="md-tabs__link">
          
  
    
  
  Observability

        </a>
      </li>
    
  

      
        
  
  
    
  
  
    
    
      <li class="md-tabs__item md-tabs__item--active">
        <a href="../" class="md-tabs__link">
          
  
    
  
  Homelab

        </a>
      </li>
    
  

      
        
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../../misc/hello-world-apps/" class="md-tabs__link">
          
  
    
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
    
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Andy&#39;s Technical Scratchpad" class="md-nav__button md-logo" aria-label="Andy's Technical Scratchpad" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    Andy's Technical Scratchpad
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Knappek/Knappek.github.io" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    Knappek/Knappek.github.io
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Kubernetes
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Kubernetes
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/architecture-concepts/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Kubernetes Architecture Concepts
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../kubernetes/deploy-ha-k3s/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy a HA k3s Cluster
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Tanzu
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Tanzu
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    TKGS
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            TKGS
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/tkgs/tkgs-nsxt-integration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Integration with NSX-T
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/tkgs/supervisor-cluster-upgrade-failed-in-vsphere-8/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Failed Supervisor Cluster upgrade
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/tkgs/tkgs-airgapped/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airgapped TKGS homelab environment
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/tkgs/disaster-scenarios/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Disaster Scenarios
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/tkgs/customize-k8s-auditing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Customize Kubernetes Auditing
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tanzu/cf/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Cloud Foundry
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            Cloud Foundry
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/cf/using-cf/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using Cloud Foundry
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tanzu/tanzu-packages/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tanzu Packages
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Tanzu Packages
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/tanzu-packages/deploy-packages-airgapped/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Airgapped Installation
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tanzu/platform-automation-toolkit/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Platform Automation Toolkit
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            Platform Automation Toolkit
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/platform-automation-toolkit/install-concourse-for-platform-automation/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Install Concourse for Platform Automation
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/platform-automation-toolkit/deploy-vsphere-with-nsxt-for-tas-tkgi/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy vSphere + NSX-T to be used for TAS and TKGI
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../tanzu/platform-automation-toolkit/deploy-tas-tkgi-with-concourse/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy TAS and TKGI with Concourse
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Observability
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Observability
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../observability/write-k8s-audit-logs-to-loki-grafana-cloud/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Write K8s Audit Logs to Loki in Grafana Cloud
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
      
        
          
        
      
        
      
    
    
      
        
        
      
      
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--section md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Homelab
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            Homelab
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Airgapped TKGS homelab environment
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Airgapped TKGS homelab environment
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-setup-with-internet-access" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Setup with internet access
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restrict-internet-access-in-vyos-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Restrict internet access in VyOS interfaces
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
        
      
        
      
    
    
      
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          <label class="md-nav__link" for="__nav_6" id="__nav_6_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Misc
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/hello-world-apps/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Hello World Apps
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/mac-and-tmux-config/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Mac & tmux Config
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/deploy-ubuntu-on-vcenter/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Deploy Ubuntu VM on vCenter
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../misc/nsx-rest-api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    NSX REST API
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#initial-setup-with-internet-access" class="md-nav__link">
    <span class="md-ellipsis">
      Initial Setup with internet access
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#restrict-internet-access-in-vyos-interfaces" class="md-nav__link">
    <span class="md-ellipsis">
      Restrict internet access in VyOS interfaces
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="set-up-an-airgapped-tkgs-homelab-environment">Set up an airgapped TKGS homelab environment</h1>
<p>We will create a fully airgapped TKGS (aka vSphere with Tanzu) environment. This is a common setup of lots of our customers who run vSphere with Tanzu without any internet connection, not even via a proxy.</p>
<p>As described in <a href="../#nested-lab-setup">Nested Lab Setup</a> we will use <a href="https://github.com/laidbackware/vmware-lab-builder">vmware-lab-builder</a> to bootstrap nested lab environments. This Ansible playbook is not (yet) implemented to work in airgapped environments as it creates a <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-tkg/GUID-C8096867-6C18-4CB2-8803-C95100D54F8B.html">subscribed content library</a>. Hence, we will first run <code>vmware-lab-builder</code> with internet access to bootstrap a TKGS Supervisor Cluster and afterwards, we create a <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-tkg/GUID-19E8E034-5256-4EFC-BEBF-D4F17A8ED021.html">Local Content Library</a> to provision guest clusters without internet access.</p>
<h2 id="initial-setup-with-internet-access">Initial Setup with internet access</h2>
<p>As mentioned in the <a href="../#networking-routing">lab network setup</a> we use a virtualized VyOS router to route all traffic in our homelab. For the TKGS with NSX-T environment we configure the following interface in VyOS</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span>address<span class="w"> </span><span class="m">172</span>.20.16.1/22
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span>description<span class="w"> </span>tanzu-without-dhcp
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span>address<span class="w"> </span><span class="m">172</span>.20.20.1/22
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span>description<span class="w"> </span>nsxt-tep
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a>commit<span class="w"> </span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a>save
</span></code></pre></div>
<p>The result is:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#__codelineno-1-1"></a>vyos@vyos#<span class="w"> </span>show<span class="w"> </span>interfaces
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#__codelineno-1-2"></a><span class="w"> </span>ethernet<span class="w"> </span>eth0<span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#__codelineno-1-3"></a><span class="w">     </span>address<span class="w"> </span><span class="m">192</span>.168.178.101/24
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#__codelineno-1-4"></a><span class="w">     </span>hw-id<span class="w"> </span><span class="m">00</span>:0c:29:85:a5:3b
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#__codelineno-1-5"></a><span class="w">     </span>offload<span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#__codelineno-1-6"></a><span class="w">         </span>gro
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#__codelineno-1-7"></a><span class="w">         </span>gso
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#__codelineno-1-8"></a><span class="w">         </span>sg
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#__codelineno-1-9"></a><span class="w">         </span>tso
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#__codelineno-1-10"></a><span class="w">     </span><span class="o">}</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#__codelineno-1-11"></a><span class="w"> </span><span class="o">}</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#__codelineno-1-12"></a><span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#__codelineno-1-13"></a><span class="w">     </span>hw-id<span class="w"> </span><span class="m">00</span>:0c:29:85:a5:45
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#__codelineno-1-14"></a><span class="w">     </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#__codelineno-1-15"></a><span class="w">     </span>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#__codelineno-1-16"></a><span class="w">         </span>address<span class="w"> </span><span class="m">172</span>.20.16.1/22
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#__codelineno-1-17"></a><span class="w">         </span>description<span class="w"> </span>tanzu-without-dhcp
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#__codelineno-1-18"></a><span class="w">         </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-1-19"><a id="__codelineno-1-19" name="__codelineno-1-19" href="#__codelineno-1-19"></a><span class="w">     </span><span class="o">}</span>
</span><span id="__span-1-20"><a id="__codelineno-1-20" name="__codelineno-1-20" href="#__codelineno-1-20"></a><span class="w">     </span>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-21"><a id="__codelineno-1-21" name="__codelineno-1-21" href="#__codelineno-1-21"></a><span class="w">         </span>address<span class="w"> </span><span class="m">172</span>.20.20.1/22
</span><span id="__span-1-22"><a id="__codelineno-1-22" name="__codelineno-1-22" href="#__codelineno-1-22"></a><span class="w">         </span>description<span class="w"> </span>nsxt-tep
</span><span id="__span-1-23"><a id="__codelineno-1-23" name="__codelineno-1-23" href="#__codelineno-1-23"></a><span class="w">         </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-1-24"><a id="__codelineno-1-24" name="__codelineno-1-24" href="#__codelineno-1-24"></a><span class="w">     </span><span class="o">}</span>
</span><span id="__span-1-25"><a id="__codelineno-1-25" name="__codelineno-1-25" href="#__codelineno-1-25"></a><span class="w"> </span><span class="o">}</span>
</span><span id="__span-1-26"><a id="__codelineno-1-26" name="__codelineno-1-26" href="#__codelineno-1-26"></a><span class="w"> </span>loopback<span class="w"> </span>lo<span class="w"> </span><span class="o">{</span>
</span><span id="__span-1-27"><a id="__codelineno-1-27" name="__codelineno-1-27" href="#__codelineno-1-27"></a><span class="w"> </span><span class="o">}</span>
</span></code></pre></div>
<p>where <code>vif 16</code> is used for all Virtual Machines and <code>vif 20</code> for the <a href="https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-with-tanzu-installation-configuration/GUID-E1C7E1DD-8D5D-4BEF-BBB0-61A7F7EBFB7A.html">NSX-T TEP network infrastructure</a>.</p>
<p>For the Supervisor Management Network, for the Egress and Ingress range, we create a VyOS protocol (static route)</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#__codelineno-2-1"></a><span class="nb">set</span><span class="w"> </span>protocols<span class="w"> </span>static<span class="w"> </span>route<span class="w"> </span><span class="m">172</span>.30.4.0/24<span class="w"> </span>next-hop<span class="w"> </span><span class="m">172</span>.20.16.103
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#__codelineno-2-2"></a>commit
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#__codelineno-2-3"></a>save
</span></code></pre></div>
<p>The result is:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#__codelineno-3-1"></a>vyos@vyos#<span class="w"> </span>show<span class="w"> </span>protocols
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#__codelineno-3-2"></a><span class="w"> </span>static<span class="w"> </span><span class="o">{</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#__codelineno-3-3"></a><span class="w">     </span>route<span class="w"> </span><span class="m">172</span>.30.4.0/24<span class="w"> </span><span class="o">{</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#__codelineno-3-4"></a><span class="w">         </span>next-hop<span class="w"> </span><span class="m">172</span>.20.16.103<span class="w"> </span><span class="o">{</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#__codelineno-3-5"></a><span class="w">         </span><span class="o">}</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#__codelineno-3-6"></a><span class="w">     </span><span class="o">}</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#__codelineno-3-7"></a><span class="w"> </span><span class="o">}</span>
</span></code></pre></div>
<p>here, <code>172.20.16.103</code> will be the Tier-0 Gateway sitting on <code>vif 16</code>.</p>
<p>My <code>vmware-lab-builder</code> config looks like this:</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#__codelineno-4-1"></a><span class="nn">---</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#__codelineno-4-2"></a><span class="c1"># SOFTWARE_DIR must contain all required software</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#__codelineno-4-3"></a><span class="nt">vc_iso</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;SOFTWARE_DIR&#39;)</span><span class="nv"> </span><span class="s">}}/VMware-VCSA-all-7.0.3-19717403.iso&quot;</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#__codelineno-4-4"></a><span class="nt">esxi_ova</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;SOFTWARE_DIR&#39;)</span><span class="nv"> </span><span class="s">}}/Nested_ESXi7.0u3c_Appliance_Template_v1.ova&quot;</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#__codelineno-4-5"></a><span class="nt">nsxt_ova</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;SOFTWARE_DIR&#39;)</span><span class="nv"> </span><span class="s">}}/nsx-unified-appliance-4.1.2.1.0.22667794.ova&quot;</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#__codelineno-4-7"></a><span class="nt">environment_tag</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tkgs-nsxt&quot;</span><span class="w">  </span><span class="c1"># Used to prepend object names in hosting vCenter</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#__codelineno-4-8"></a><span class="nt">dns_server</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.168.178.1&quot;</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#__codelineno-4-9"></a><span class="nt">dns_domain</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;home.local&quot;</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#__codelineno-4-10"></a><span class="nt">ntp_server_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.168.178.1&quot;</span><span class="w">  </span><span class="c1"># Must be set to an IP address!</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#__codelineno-4-11"></a><span class="nt">disk_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">thin</span><span class="w">  </span><span class="c1"># How all disks should be deployed</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#__codelineno-4-12"></a><span class="nt">nested_host_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.master_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#__codelineno-4-13"></a>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#__codelineno-4-14"></a><span class="nt">hosting_vcenter</span><span class="p">:</span><span class="w">  </span><span class="c1"># This is the vCenter which will be the target for nested vCenters and ESXi hosts</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#__codelineno-4-15"></a><span class="w">  </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;192.168.178.102&quot;</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#__codelineno-4-16"></a><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;PARENT_VCENTER_USERNAME&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#__codelineno-4-17"></a><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;PARENT_VCENTER_PASSWORD&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#__codelineno-4-18"></a><span class="w">  </span><span class="nt">datacenter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Home&quot;</span><span class="w">  </span><span class="c1"># Target for all VM deployment</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#__codelineno-4-19"></a>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#__codelineno-4-20"></a><span class="c1"># This section describes what will be created</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#__codelineno-4-21"></a><span class="nt">opinionated</span><span class="p">:</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#__codelineno-4-22"></a><span class="w">  </span><span class="nt">master_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;VMware1!&quot;</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#__codelineno-4-23"></a><span class="w">  </span><span class="nt">nested_hosts</span><span class="p">:</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#__codelineno-4-24"></a><span class="w">    </span><span class="nt">cpu_cores</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">12</span><span class="w">  </span><span class="c1"># CPU count per nested host</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#__codelineno-4-25"></a><span class="w">    </span><span class="nt">ram_in_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">128</span><span class="w">  </span><span class="c1"># memory per nested host</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#__codelineno-4-26"></a><span class="w">    </span><span class="nt">local_disks</span><span class="p">:</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#__codelineno-4-27"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">size_gb</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">500</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#__codelineno-4-28"></a><span class="w">        </span><span class="nt">datastore_prefix</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;datastore&quot;</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#__codelineno-4-29"></a><span class="w">  </span><span class="nt">hosting_cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Physical</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#__codelineno-4-30"></a><span class="w">  </span><span class="nt">hosting_datastore</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NVME</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#__codelineno-4-31"></a><span class="w">  </span><span class="nt">hosting_network</span><span class="p">:</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#__codelineno-4-32"></a><span class="w">    </span><span class="nt">base</span><span class="p">:</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#__codelineno-4-33"></a><span class="w">      </span><span class="nt">port_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tanzu-without-dhcp</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#__codelineno-4-34"></a><span class="w">      </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.20.16.0/22&quot;</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#__codelineno-4-35"></a><span class="w">      </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.20.16.1&quot;</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#__codelineno-4-36"></a><span class="w">      </span><span class="c1"># A NSX-T deployment requires 4 IPs, plus 1 per esxi host. They MUST be contiguous.</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#__codelineno-4-37"></a><span class="w">      </span><span class="nt">starting_addr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.20.16.100&quot;</span>
</span><span id="__span-4-38"><a id="__codelineno-4-38" name="__codelineno-4-38" href="#__codelineno-4-38"></a><span class="w">    </span><span class="c1"># nsxt tep pool will not be routed, but should not clash with routeable ranges</span>
</span><span id="__span-4-39"><a id="__codelineno-4-39" name="__codelineno-4-39" href="#__codelineno-4-39"></a><span class="w">    </span><span class="nt">nsxt_tep</span><span class="p">:</span>
</span><span id="__span-4-40"><a id="__codelineno-4-40" name="__codelineno-4-40" href="#__codelineno-4-40"></a><span class="w">      </span><span class="nt">port_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsxt-tep</span>
</span><span id="__span-4-41"><a id="__codelineno-4-41" name="__codelineno-4-41" href="#__codelineno-4-41"></a><span class="w">      </span><span class="nt">vlan_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-4-42"><a id="__codelineno-4-42" name="__codelineno-4-42" href="#__codelineno-4-42"></a><span class="w">      </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;172.20.20.0/22&quot;</span><span class="w">  </span><span class="c1"># Should be at least a 29 which supports up to 5 hosts and 1 edge</span>
</span><span id="__span-4-43"><a id="__codelineno-4-43" name="__codelineno-4-43" href="#__codelineno-4-43"></a><span class="w">  </span><span class="nt">tanzu_vsphere</span><span class="p">:</span>
</span><span id="__span-4-44"><a id="__codelineno-4-44" name="__codelineno-4-44" href="#__codelineno-4-44"></a><span class="w">    </span><span class="c1"># This network must be minimum of a /25</span>
</span><span id="__span-4-45"><a id="__codelineno-4-45" name="__codelineno-4-45" href="#__codelineno-4-45"></a><span class="w">    </span><span class="c1"># 1/8 of the network will be used for the supervisor</span>
</span><span id="__span-4-46"><a id="__codelineno-4-46" name="__codelineno-4-46" href="#__codelineno-4-46"></a><span class="w">    </span><span class="c1"># 3/8 of the network will be used for egress IP range</span>
</span><span id="__span-4-47"><a id="__codelineno-4-47" name="__codelineno-4-47" href="#__codelineno-4-47"></a><span class="w">    </span><span class="c1"># 1/2 of the network will be used for ingress IP range</span>
</span><span id="__span-4-48"><a id="__codelineno-4-48" name="__codelineno-4-48" href="#__codelineno-4-48"></a><span class="w">    </span><span class="nt">routeable_super_net</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.30.4.0/24</span>
</span><span id="__span-4-49"><a id="__codelineno-4-49" name="__codelineno-4-49" href="#__codelineno-4-49"></a><span class="w">    </span><span class="c1"># This network is private and should not overlap with any routable networks</span>
</span><span id="__span-4-50"><a id="__codelineno-4-50" name="__codelineno-4-50" href="#__codelineno-4-50"></a><span class="w">    </span><span class="nt">internal_pod_network</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.32.0.0/22</span>
</span><span id="__span-4-51"><a id="__codelineno-4-51" name="__codelineno-4-51" href="#__codelineno-4-51"></a><span class="w">    </span><span class="c1"># This network is private and should not overlap with any routable networks</span>
</span><span id="__span-4-52"><a id="__codelineno-4-52" name="__codelineno-4-52" href="#__codelineno-4-52"></a><span class="w">    </span><span class="nt">internal_kubernetes_services_network</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">172.32.4.0/22</span>
</span><span id="__span-4-53"><a id="__codelineno-4-53" name="__codelineno-4-53" href="#__codelineno-4-53"></a>
</span><span id="__span-4-54"><a id="__codelineno-4-54" name="__codelineno-4-54" href="#__codelineno-4-54"></a><span class="c1">#####################################################################</span>
</span><span id="__span-4-55"><a id="__codelineno-4-55" name="__codelineno-4-55" href="#__codelineno-4-55"></a><span class="c1">### No need to edit below this line for an opinionated deployment ###</span>
</span><span id="__span-4-56"><a id="__codelineno-4-56" name="__codelineno-4-56" href="#__codelineno-4-56"></a><span class="c1">#####################################################################</span>
</span><span id="__span-4-57"><a id="__codelineno-4-57" name="__codelineno-4-57" href="#__codelineno-4-57"></a>
</span><span id="__span-4-58"><a id="__codelineno-4-58" name="__codelineno-4-58" href="#__codelineno-4-58"></a><span class="nt">nested_vcenter</span><span class="p">:</span><span class="w">  </span><span class="c1"># the vCenter appliance that will be deployed</span>
</span><span id="__span-4-59"><a id="__codelineno-4-59" name="__codelineno-4-59" href="#__codelineno-4-59"></a><span class="w">  </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># vCenter ip address</span>
</span><span id="__span-4-60"><a id="__codelineno-4-60" name="__codelineno-4-60" href="#__codelineno-4-60"></a><span class="w">  </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.cidr.split(&#39;/&#39;)[1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-61"><a id="__codelineno-4-61" name="__codelineno-4-61" href="#__codelineno-4-61"></a><span class="w">  </span><span class="nt">gw</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.gateway</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-62"><a id="__codelineno-4-62" name="__codelineno-4-62" href="#__codelineno-4-62"></a><span class="w">  </span><span class="nt">host_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># FQDN if there is working DNS server, otherwise put the ip as a name</span>
</span><span id="__span-4-63"><a id="__codelineno-4-63" name="__codelineno-4-63" href="#__codelineno-4-63"></a><span class="w">  </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;administrator@vsphere.local&quot;</span>
</span><span id="__span-4-64"><a id="__codelineno-4-64" name="__codelineno-4-64" href="#__codelineno-4-64"></a><span class="w">  </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.master_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-65"><a id="__codelineno-4-65" name="__codelineno-4-65" href="#__codelineno-4-65"></a><span class="w">  </span><span class="nt">datacenter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Lab&quot;</span><span class="w">  </span><span class="c1"># DC to create after deployment</span>
</span><span id="__span-4-66"><a id="__codelineno-4-66" name="__codelineno-4-66" href="#__codelineno-4-66"></a><span class="w">  </span><span class="c1"># Below are properties of parent cluster</span>
</span><span id="__span-4-67"><a id="__codelineno-4-67" name="__codelineno-4-67" href="#__codelineno-4-67"></a><span class="w">  </span><span class="nt">hosting_network</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.port_group</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># Parent port group where the vCenter VM will be deployed</span>
</span><span id="__span-4-68"><a id="__codelineno-4-68" name="__codelineno-4-68" href="#__codelineno-4-68"></a><span class="w">  </span><span class="nt">hosting_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_cluster</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># Parent cluster where the vCenter VM will be deployed</span>
</span><span id="__span-4-69"><a id="__codelineno-4-69" name="__codelineno-4-69" href="#__codelineno-4-69"></a><span class="w">  </span><span class="nt">hosting_datastore</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_datastore</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># Parent datastore where the vCenter VM will be deployed</span>
</span><span id="__span-4-70"><a id="__codelineno-4-70" name="__codelineno-4-70" href="#__codelineno-4-70"></a>
</span><span id="__span-4-71"><a id="__codelineno-4-71" name="__codelineno-4-71" href="#__codelineno-4-71"></a><span class="nt">nested_clusters</span><span class="p">:</span><span class="w">  </span><span class="c1"># You can add clusters in this section by duplicating the existing cluster</span>
</span><span id="__span-4-72"><a id="__codelineno-4-72" name="__codelineno-4-72" href="#__codelineno-4-72"></a><span class="w">  </span><span class="nt">compute</span><span class="p">:</span><span class="w">  </span><span class="c1"># This will be the name of the cluster in the nested  vCenter. Below are the minimum settings.</span>
</span><span id="__span-4-73"><a id="__codelineno-4-73" name="__codelineno-4-73" href="#__codelineno-4-73"></a><span class="w">    </span><span class="nt">enable_drs</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-74"><a id="__codelineno-4-74" name="__codelineno-4-74" href="#__codelineno-4-74"></a><span class="w">    </span><span class="nt">enable_ha</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-75"><a id="__codelineno-4-75" name="__codelineno-4-75" href="#__codelineno-4-75"></a><span class="w">    </span><span class="c1"># Below are properties of the hosting cluster</span>
</span><span id="__span-4-76"><a id="__codelineno-4-76" name="__codelineno-4-76" href="#__codelineno-4-76"></a><span class="w">    </span><span class="nt">hosting_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_cluster</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># The nested ESXi VMs will be deployed here</span>
</span><span id="__span-4-77"><a id="__codelineno-4-77" name="__codelineno-4-77" href="#__codelineno-4-77"></a><span class="w">    </span><span class="nt">hosting_datastore</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_datastore</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># Datastore target for nested ESXi VMs</span>
</span><span id="__span-4-78"><a id="__codelineno-4-78" name="__codelineno-4-78" href="#__codelineno-4-78"></a><span class="w">    </span><span class="c1"># Settings below are assigned to each host in the cluster</span>
</span><span id="__span-4-79"><a id="__codelineno-4-79" name="__codelineno-4-79" href="#__codelineno-4-79"></a><span class="w">    </span><span class="nt">vswitch0_vm_port_group_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-network</span>
</span><span id="__span-4-80"><a id="__codelineno-4-80" name="__codelineno-4-80" href="#__codelineno-4-80"></a><span class="w">    </span><span class="nt">vswitch0_vm_port_group_vlan</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span>
</span><span id="__span-4-81"><a id="__codelineno-4-81" name="__codelineno-4-81" href="#__codelineno-4-81"></a><span class="w">    </span><span class="nt">cpu_cores</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.nested_hosts.cpu_cores</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># CPU count</span>
</span><span id="__span-4-82"><a id="__codelineno-4-82" name="__codelineno-4-82" href="#__codelineno-4-82"></a><span class="w">    </span><span class="nt">ram_in_gb</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.nested_hosts.ram_in_gb</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># memory</span>
</span><span id="__span-4-83"><a id="__codelineno-4-83" name="__codelineno-4-83" href="#__codelineno-4-83"></a><span class="w">    </span><span class="c1"># In order list of disks to assign to the nested host. All will be marked as SSD.</span>
</span><span id="__span-4-84"><a id="__codelineno-4-84" name="__codelineno-4-84" href="#__codelineno-4-84"></a><span class="w">    </span><span class="c1"># Datastore names will be automatically be pre-pended with the hostname. E.g esx1</span>
</span><span id="__span-4-85"><a id="__codelineno-4-85" name="__codelineno-4-85" href="#__codelineno-4-85"></a><span class="w">    </span><span class="c1"># If the datastore_prefix property is removed the disk will not be set as a datastore</span>
</span><span id="__span-4-86"><a id="__codelineno-4-86" name="__codelineno-4-86" href="#__codelineno-4-86"></a><span class="w">    </span><span class="c1"># To leave the default OVA disks in place, delete this section.</span>
</span><span id="__span-4-87"><a id="__codelineno-4-87" name="__codelineno-4-87" href="#__codelineno-4-87"></a><span class="w">    </span><span class="nt">nested_hosts_disks</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.nested_hosts.local_disks</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">default(omit)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-88"><a id="__codelineno-4-88" name="__codelineno-4-88" href="#__codelineno-4-88"></a><span class="w">    </span><span class="c1"># Added in vmnic order, these port groups must exist on the physical host</span>
</span><span id="__span-4-89"><a id="__codelineno-4-89" name="__codelineno-4-89" href="#__codelineno-4-89"></a><span class="w">    </span><span class="c1"># Must specify at least 2 port groups, up to a maximum of 10</span>
</span><span id="__span-4-90"><a id="__codelineno-4-90" name="__codelineno-4-90" href="#__codelineno-4-90"></a><span class="w">    </span><span class="nt">vmnic_physical_portgroup_assignment</span><span class="p">:</span>
</span><span id="__span-4-91"><a id="__codelineno-4-91" name="__codelineno-4-91" href="#__codelineno-4-91"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.port_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-92"><a id="__codelineno-4-92" name="__codelineno-4-92" href="#__codelineno-4-92"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.nsxt_tep.port_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-93"><a id="__codelineno-4-93" name="__codelineno-4-93" href="#__codelineno-4-93"></a>
</span><span id="__span-4-94"><a id="__codelineno-4-94" name="__codelineno-4-94" href="#__codelineno-4-94"></a><span class="nt">nested_hosts</span><span class="p">:</span>
</span><span id="__span-4-95"><a id="__codelineno-4-95" name="__codelineno-4-95" href="#__codelineno-4-95"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;esx1&quot;</span>
</span><span id="__span-4-96"><a id="__codelineno-4-96" name="__codelineno-4-96" href="#__codelineno-4-96"></a><span class="w">    </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(4)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-97"><a id="__codelineno-4-97" name="__codelineno-4-97" href="#__codelineno-4-97"></a><span class="w">    </span><span class="nt">mask</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.cidr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipaddr(&#39;netmask&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-98"><a id="__codelineno-4-98" name="__codelineno-4-98" href="#__codelineno-4-98"></a><span class="w">    </span><span class="nt">gw</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.gateway</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-99"><a id="__codelineno-4-99" name="__codelineno-4-99" href="#__codelineno-4-99"></a><span class="w">    </span><span class="nt">nested_cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute</span>
</span><span id="__span-4-100"><a id="__codelineno-4-100" name="__codelineno-4-100" href="#__codelineno-4-100"></a>
</span><span id="__span-4-101"><a id="__codelineno-4-101" name="__codelineno-4-101" href="#__codelineno-4-101"></a><span class="nt">distributed_switches</span><span class="p">:</span><span class="w">  </span><span class="c1"># (optional) - section can be removed to not create any distributed switches</span>
</span><span id="__span-4-102"><a id="__codelineno-4-102" name="__codelineno-4-102" href="#__codelineno-4-102"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">vds_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsxt-vds</span>
</span><span id="__span-4-103"><a id="__codelineno-4-103" name="__codelineno-4-103" href="#__codelineno-4-103"></a><span class="w">    </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1600</span>
</span><span id="__span-4-104"><a id="__codelineno-4-104" name="__codelineno-4-104" href="#__codelineno-4-104"></a><span class="w">    </span><span class="nt">vds_version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">7.0.0</span><span class="w">  </span><span class="c1"># Should be 7.0.0, 6.7.0</span>
</span><span id="__span-4-105"><a id="__codelineno-4-105" name="__codelineno-4-105" href="#__codelineno-4-105"></a><span class="w">    </span><span class="nt">clusters</span><span class="p">:</span><span class="w">  </span><span class="c1"># distributed switch will be attached to all hosts in the clusters listed</span>
</span><span id="__span-4-106"><a id="__codelineno-4-106" name="__codelineno-4-106" href="#__codelineno-4-106"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute</span>
</span><span id="__span-4-107"><a id="__codelineno-4-107" name="__codelineno-4-107" href="#__codelineno-4-107"></a><span class="w">    </span><span class="nt">uplink_quantity</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-4-108"><a id="__codelineno-4-108" name="__codelineno-4-108" href="#__codelineno-4-108"></a><span class="w">    </span><span class="nt">vmnics</span><span class="p">:</span>
</span><span id="__span-4-109"><a id="__codelineno-4-109" name="__codelineno-4-109" href="#__codelineno-4-109"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vmnic1</span>
</span><span id="__span-4-110"><a id="__codelineno-4-110" name="__codelineno-4-110" href="#__codelineno-4-110"></a>
</span><span id="__span-4-111"><a id="__codelineno-4-111" name="__codelineno-4-111" href="#__codelineno-4-111"></a>
</span><span id="__span-4-112"><a id="__codelineno-4-112" name="__codelineno-4-112" href="#__codelineno-4-112"></a><span class="nt">tspbm</span><span class="p">:</span><span class="w">  </span><span class="c1"># Tag-based Storage Policy Based Management</span>
</span><span id="__span-4-113"><a id="__codelineno-4-113" name="__codelineno-4-113" href="#__codelineno-4-113"></a><span class="w">  </span><span class="nt">tag_categories</span><span class="p">:</span>
</span><span id="__span-4-114"><a id="__codelineno-4-114" name="__codelineno-4-114" href="#__codelineno-4-114"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">category_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-storage-category</span>
</span><span id="__span-4-115"><a id="__codelineno-4-115" name="__codelineno-4-115" href="#__codelineno-4-115"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TKGS</span><span class="nv"> </span><span class="s">tag</span><span class="nv"> </span><span class="s">category&quot;</span>
</span><span id="__span-4-116"><a id="__codelineno-4-116" name="__codelineno-4-116" href="#__codelineno-4-116"></a><span class="w">      </span><span class="nt">tags</span><span class="p">:</span>
</span><span id="__span-4-117"><a id="__codelineno-4-117" name="__codelineno-4-117" href="#__codelineno-4-117"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">tag_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-storage-tag</span>
</span><span id="__span-4-118"><a id="__codelineno-4-118" name="__codelineno-4-118" href="#__codelineno-4-118"></a><span class="w">          </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Tag</span><span class="nv"> </span><span class="s">for</span><span class="nv"> </span><span class="s">datastores</span><span class="nv"> </span><span class="s">used</span><span class="nv"> </span><span class="s">by</span><span class="nv"> </span><span class="s">TKGS&quot;</span>
</span><span id="__span-4-119"><a id="__codelineno-4-119" name="__codelineno-4-119" href="#__codelineno-4-119"></a><span class="w">  </span><span class="nt">datastore_tags</span><span class="p">:</span>
</span><span id="__span-4-120"><a id="__codelineno-4-120" name="__codelineno-4-120" href="#__codelineno-4-120"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">datastore_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.nested_hosts.local_disks[0].datastore_prefix</span><span class="nv"> </span><span class="s">}}-esx1&quot;</span>
</span><span id="__span-4-121"><a id="__codelineno-4-121" name="__codelineno-4-121" href="#__codelineno-4-121"></a><span class="w">      </span><span class="nt">tag_names</span><span class="p">:</span>
</span><span id="__span-4-122"><a id="__codelineno-4-122" name="__codelineno-4-122" href="#__codelineno-4-122"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-storage-tag</span>
</span><span id="__span-4-123"><a id="__codelineno-4-123" name="__codelineno-4-123" href="#__codelineno-4-123"></a><span class="w">  </span><span class="nt">vm_storage_policies</span><span class="p">:</span>
</span><span id="__span-4-124"><a id="__codelineno-4-124" name="__codelineno-4-124" href="#__codelineno-4-124"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">storage_policy_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-storage-policy</span>
</span><span id="__span-4-125"><a id="__codelineno-4-125" name="__codelineno-4-125" href="#__codelineno-4-125"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;TKGS</span><span class="nv"> </span><span class="s">storage</span><span class="nv"> </span><span class="s">performance</span><span class="nv"> </span><span class="s">policy&quot;</span>
</span><span id="__span-4-126"><a id="__codelineno-4-126" name="__codelineno-4-126" href="#__codelineno-4-126"></a><span class="w">      </span><span class="nt">tag_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-storage-tag</span>
</span><span id="__span-4-127"><a id="__codelineno-4-127" name="__codelineno-4-127" href="#__codelineno-4-127"></a><span class="w">      </span><span class="nt">tag_category</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-storage-category</span>
</span><span id="__span-4-128"><a id="__codelineno-4-128" name="__codelineno-4-128" href="#__codelineno-4-128"></a>
</span><span id="__span-4-129"><a id="__codelineno-4-129" name="__codelineno-4-129" href="#__codelineno-4-129"></a><span class="nt">tanzu_vsphere</span><span class="p">:</span>
</span><span id="__span-4-130"><a id="__codelineno-4-130" name="__codelineno-4-130" href="#__codelineno-4-130"></a><span class="w">  </span><span class="nt">services_cidr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.tanzu_vsphere.internal_kubernetes_services_network</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="w">  </span><span class="c1"># This is private within each cluster</span>
</span><span id="__span-4-131"><a id="__codelineno-4-131" name="__codelineno-4-131" href="#__codelineno-4-131"></a><span class="w">  </span><span class="nt">content_library_datastore</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.nested_hosts.local_disks[0].datastore_prefix</span><span class="nv"> </span><span class="s">}}-esx1&quot;</span>
</span><span id="__span-4-132"><a id="__codelineno-4-132" name="__codelineno-4-132" href="#__codelineno-4-132"></a><span class="w">  </span><span class="nt">content_library_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-library</span>
</span><span id="__span-4-133"><a id="__codelineno-4-133" name="__codelineno-4-133" href="#__codelineno-4-133"></a><span class="w">  </span><span class="nt">content_library_url</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;http://wp-content.vmware.com/v2/latest/lib.json&quot;</span>
</span><span id="__span-4-134"><a id="__codelineno-4-134" name="__codelineno-4-134" href="#__codelineno-4-134"></a><span class="w">  </span><span class="nt">default_content_library</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-library</span>
</span><span id="__span-4-135"><a id="__codelineno-4-135" name="__codelineno-4-135" href="#__codelineno-4-135"></a><span class="w">  </span><span class="nt">dns_server_list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">dns_server</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-136"><a id="__codelineno-4-136" name="__codelineno-4-136" href="#__codelineno-4-136"></a><span class="w">  </span><span class="nt">ephemeral_storage_policy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">tspbm.vm_storage_policies[0].storage_policy_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-137"><a id="__codelineno-4-137" name="__codelineno-4-137" href="#__codelineno-4-137"></a><span class="w">  </span><span class="nt">fluentbit_enabled</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-4-138"><a id="__codelineno-4-138" name="__codelineno-4-138" href="#__codelineno-4-138"></a><span class="w">  </span><span class="nt">image_storage_policy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">tspbm.vm_storage_policies[0].storage_policy_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-139"><a id="__codelineno-4-139" name="__codelineno-4-139" href="#__codelineno-4-139"></a><span class="w">  </span><span class="nt">ntp_server_list</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">ntp_server_ip</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-140"><a id="__codelineno-4-140" name="__codelineno-4-140" href="#__codelineno-4-140"></a><span class="w">  </span><span class="nt">management_dns_servers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">dns_server</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-141"><a id="__codelineno-4-141" name="__codelineno-4-141" href="#__codelineno-4-141"></a><span class="w">  </span><span class="nt">management_port_group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">supervisor-seg</span>
</span><span id="__span-4-142"><a id="__codelineno-4-142" name="__codelineno-4-142" href="#__codelineno-4-142"></a><span class="w">  </span><span class="nt">management_gateway</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.tanzu_vsphere.routeable_super_net</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(1)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-143"><a id="__codelineno-4-143" name="__codelineno-4-143" href="#__codelineno-4-143"></a><span class="w">  </span><span class="nt">management_netmask</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-4-144"><a id="__codelineno-4-144" name="__codelineno-4-144" href="#__codelineno-4-144"></a><span class="w">    </span><span class="no">{{ opinionated.tanzu_vsphere.routeable_super_net |</span>
</span><span id="__span-4-145"><a id="__codelineno-4-145" name="__codelineno-4-145" href="#__codelineno-4-145"></a><span class="w">    </span><span class="no">ansible.utils.ipsubnet((opinionated.tanzu_vsphere.routeable_super_net.split(&#39;/&#39;)[1] |int)+3, 0) |</span>
</span><span id="__span-4-146"><a id="__codelineno-4-146" name="__codelineno-4-146" href="#__codelineno-4-146"></a><span class="w">    </span><span class="no">ansible.utils.ipaddr(&#39;netmask&#39;) }}</span>
</span><span id="__span-4-147"><a id="__codelineno-4-147" name="__codelineno-4-147" href="#__codelineno-4-147"></a><span class="w">  </span><span class="nt">management_starting_address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.tanzu_vsphere.routeable_super_net</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(2)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-148"><a id="__codelineno-4-148" name="__codelineno-4-148" href="#__codelineno-4-148"></a><span class="w">  </span><span class="nt">master_storage_policy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">tspbm.vm_storage_policies[0].storage_policy_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-149"><a id="__codelineno-4-149" name="__codelineno-4-149" href="#__codelineno-4-149"></a><span class="w">  </span><span class="nt">network_provider</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NSXT_CONTAINER_PLUGIN</span>
</span><span id="__span-4-150"><a id="__codelineno-4-150" name="__codelineno-4-150" href="#__codelineno-4-150"></a><span class="w">  </span><span class="nt">supervisor_size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tiny</span>
</span><span id="__span-4-151"><a id="__codelineno-4-151" name="__codelineno-4-151" href="#__codelineno-4-151"></a><span class="w">  </span><span class="nt">vsphere_cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute</span>
</span><span id="__span-4-152"><a id="__codelineno-4-152" name="__codelineno-4-152" href="#__codelineno-4-152"></a><span class="w">  </span><span class="nt">workload_dns_servers</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">dns_server</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-153"><a id="__codelineno-4-153" name="__codelineno-4-153" href="#__codelineno-4-153"></a>
</span><span id="__span-4-154"><a id="__codelineno-4-154" name="__codelineno-4-154" href="#__codelineno-4-154"></a><span class="w">  </span><span class="nt">nsxt</span><span class="p">:</span>
</span><span id="__span-4-155"><a id="__codelineno-4-155" name="__codelineno-4-155" href="#__codelineno-4-155"></a><span class="w">    </span><span class="nt">cluster_distributed_switch</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">distributed_switches[0].vds_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-156"><a id="__codelineno-4-156" name="__codelineno-4-156" href="#__codelineno-4-156"></a><span class="w">    </span><span class="nt">egress_cidrs</span><span class="p">:</span>
</span><span id="__span-4-157"><a id="__codelineno-4-157" name="__codelineno-4-157" href="#__codelineno-4-157"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-4-158"><a id="__codelineno-4-158" name="__codelineno-4-158" href="#__codelineno-4-158"></a><span class="w">        </span><span class="no">{{ opinionated.tanzu_vsphere.routeable_super_net |</span>
</span><span id="__span-4-159"><a id="__codelineno-4-159" name="__codelineno-4-159" href="#__codelineno-4-159"></a><span class="w">        </span><span class="no">ansible.utils.ipsubnet((opinionated.tanzu_vsphere.routeable_super_net.split(&#39;/&#39;)[1] |int)+3, 1) }}</span>
</span><span id="__span-4-160"><a id="__codelineno-4-160" name="__codelineno-4-160" href="#__codelineno-4-160"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-4-161"><a id="__codelineno-4-161" name="__codelineno-4-161" href="#__codelineno-4-161"></a><span class="w">        </span><span class="no">{{ opinionated.tanzu_vsphere.routeable_super_net |</span>
</span><span id="__span-4-162"><a id="__codelineno-4-162" name="__codelineno-4-162" href="#__codelineno-4-162"></a><span class="w">        </span><span class="no">ansible.utils.ipsubnet((opinionated.tanzu_vsphere.routeable_super_net.split(&#39;/&#39;)[1] |int)+2, 1) }}</span>
</span><span id="__span-4-163"><a id="__codelineno-4-163" name="__codelineno-4-163" href="#__codelineno-4-163"></a><span class="w">    </span><span class="nt">ingress_cidrs</span><span class="p">:</span>
</span><span id="__span-4-164"><a id="__codelineno-4-164" name="__codelineno-4-164" href="#__codelineno-4-164"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-4-165"><a id="__codelineno-4-165" name="__codelineno-4-165" href="#__codelineno-4-165"></a><span class="w">        </span><span class="no">{{ opinionated.tanzu_vsphere.routeable_super_net |</span>
</span><span id="__span-4-166"><a id="__codelineno-4-166" name="__codelineno-4-166" href="#__codelineno-4-166"></a><span class="w">        </span><span class="no">ansible.utils.ipsubnet((opinionated.tanzu_vsphere.routeable_super_net.split(&#39;/&#39;)[1] |int)+1, 1) }}</span>
</span><span id="__span-4-167"><a id="__codelineno-4-167" name="__codelineno-4-167" href="#__codelineno-4-167"></a><span class="w">    </span><span class="nt">nsx_edge_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">nsxt.edge_clusters[0].edge_cluster_name}}&quot;</span>
</span><span id="__span-4-168"><a id="__codelineno-4-168" name="__codelineno-4-168" href="#__codelineno-4-168"></a><span class="w">    </span><span class="nt">pod_cidrs</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.tanzu_vsphere.internal_pod_network</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-169"><a id="__codelineno-4-169" name="__codelineno-4-169" href="#__codelineno-4-169"></a><span class="w">    </span><span class="c1"># This is used by the task which checks if the supervisor network is online</span>
</span><span id="__span-4-170"><a id="__codelineno-4-170" name="__codelineno-4-170" href="#__codelineno-4-170"></a><span class="w">    </span><span class="nt">t0_uplink_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(3)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-171"><a id="__codelineno-4-171" name="__codelineno-4-171" href="#__codelineno-4-171"></a>
</span><span id="__span-4-172"><a id="__codelineno-4-172" name="__codelineno-4-172" href="#__codelineno-4-172"></a><span class="nt">nsxt</span><span class="p">:</span><span class="w">  </span><span class="c1"># (optional) - section can be removed to not create any nsxt objects</span>
</span><span id="__span-4-173"><a id="__codelineno-4-173" name="__codelineno-4-173" href="#__codelineno-4-173"></a><span class="w">  </span><span class="nt">manager</span><span class="p">:</span>
</span><span id="__span-4-174"><a id="__codelineno-4-174" name="__codelineno-4-174" href="#__codelineno-4-174"></a><span class="w">    </span><span class="nt">hostname</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(1)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-175"><a id="__codelineno-4-175" name="__codelineno-4-175" href="#__codelineno-4-175"></a><span class="w">    </span><span class="nt">ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(1)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-176"><a id="__codelineno-4-176" name="__codelineno-4-176" href="#__codelineno-4-176"></a><span class="w">    </span><span class="nt">netmask</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.cidr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipaddr(&#39;netmask&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-177"><a id="__codelineno-4-177" name="__codelineno-4-177" href="#__codelineno-4-177"></a><span class="w">    </span><span class="nt">gateway</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.gateway</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-178"><a id="__codelineno-4-178" name="__codelineno-4-178" href="#__codelineno-4-178"></a><span class="w">    </span><span class="nt">username</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin</span><span class="w">  </span><span class="c1"># this cannot be changed</span>
</span><span id="__span-4-179"><a id="__codelineno-4-179" name="__codelineno-4-179" href="#__codelineno-4-179"></a><span class="w">    </span><span class="nt">password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.master_password</span><span class="nv"> </span><span class="s">}}{{</span><span class="nv"> </span><span class="s">opinionated.master_password</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-180"><a id="__codelineno-4-180" name="__codelineno-4-180" href="#__codelineno-4-180"></a><span class="w">    </span><span class="nt">hosting_vcenter_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">hosting_vcenter.ip</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-181"><a id="__codelineno-4-181" name="__codelineno-4-181" href="#__codelineno-4-181"></a><span class="w">    </span><span class="nt">hosting_vcenter_username</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">hosting_vcenter.username</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-182"><a id="__codelineno-4-182" name="__codelineno-4-182" href="#__codelineno-4-182"></a><span class="w">    </span><span class="nt">hosting_vcenter_password</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">hosting_vcenter.password</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-183"><a id="__codelineno-4-183" name="__codelineno-4-183" href="#__codelineno-4-183"></a><span class="w">    </span><span class="nt">hosting_datacenter</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">hosting_vcenter.datacenter</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-184"><a id="__codelineno-4-184" name="__codelineno-4-184" href="#__codelineno-4-184"></a><span class="w">    </span><span class="nt">hosting_datastore</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_datastore</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-185"><a id="__codelineno-4-185" name="__codelineno-4-185" href="#__codelineno-4-185"></a><span class="w">    </span><span class="nt">hosting_network</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.port_group</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-186"><a id="__codelineno-4-186" name="__codelineno-4-186" href="#__codelineno-4-186"></a><span class="w">    </span><span class="nt">hosting_cluster</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_cluster</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-187"><a id="__codelineno-4-187" name="__codelineno-4-187" href="#__codelineno-4-187"></a><span class="w">    </span><span class="nt">license_key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">lookup(&#39;env&#39;,</span><span class="nv"> </span><span class="s">&#39;NSXT_LICENSE_KEY&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-188"><a id="__codelineno-4-188" name="__codelineno-4-188" href="#__codelineno-4-188"></a>
</span><span id="__span-4-189"><a id="__codelineno-4-189" name="__codelineno-4-189" href="#__codelineno-4-189"></a><span class="w">  </span><span class="c1"># If the section below is defined, the playbook will wait for the IP to become pingable</span>
</span><span id="__span-4-190"><a id="__codelineno-4-190" name="__codelineno-4-190" href="#__codelineno-4-190"></a><span class="w">  </span><span class="c1"># For TKG service deployments this is the default gateway of the supervisor network</span>
</span><span id="__span-4-191"><a id="__codelineno-4-191" name="__codelineno-4-191" href="#__codelineno-4-191"></a><span class="w">  </span><span class="nt">routing_test</span><span class="p">:</span>
</span><span id="__span-4-192"><a id="__codelineno-4-192" name="__codelineno-4-192" href="#__codelineno-4-192"></a><span class="w">    </span><span class="nt">ip_to_ping</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.tanzu_vsphere.routeable_super_net</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(1)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-193"><a id="__codelineno-4-193" name="__codelineno-4-193" href="#__codelineno-4-193"></a><span class="w">    </span><span class="c1"># The playbook will present a message using the params below</span>
</span><span id="__span-4-194"><a id="__codelineno-4-194" name="__codelineno-4-194" href="#__codelineno-4-194"></a><span class="w">    </span><span class="c1"># A static route must be made to the router uplink for nsxt_supernet</span>
</span><span id="__span-4-195"><a id="__codelineno-4-195" name="__codelineno-4-195" href="#__codelineno-4-195"></a><span class="w">    </span><span class="nt">router_uplink</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(3)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-196"><a id="__codelineno-4-196" name="__codelineno-4-196" href="#__codelineno-4-196"></a><span class="w">    </span><span class="nt">nsxt_supernet</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.tanzu_vsphere.routeable_super_net</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-197"><a id="__codelineno-4-197" name="__codelineno-4-197" href="#__codelineno-4-197"></a>
</span><span id="__span-4-198"><a id="__codelineno-4-198" name="__codelineno-4-198" href="#__codelineno-4-198"></a><span class="w">  </span><span class="nt">policy_ip_pools</span><span class="p">:</span>
</span><span id="__span-4-199"><a id="__codelineno-4-199" name="__codelineno-4-199" href="#__codelineno-4-199"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tep-pool</span><span class="w">  </span><span class="c1"># This is a non-routable range which is used for the overlay tunnels.</span>
</span><span id="__span-4-200"><a id="__codelineno-4-200" name="__codelineno-4-200" href="#__codelineno-4-200"></a><span class="w">      </span><span class="nt">pool_static_subnets</span><span class="p">:</span>
</span><span id="__span-4-201"><a id="__codelineno-4-201" name="__codelineno-4-201" href="#__codelineno-4-201"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tep-pool-1</span>
</span><span id="__span-4-202"><a id="__codelineno-4-202" name="__codelineno-4-202" href="#__codelineno-4-202"></a><span class="w">          </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-4-203"><a id="__codelineno-4-203" name="__codelineno-4-203" href="#__codelineno-4-203"></a><span class="w">          </span><span class="nt">allocation_ranges</span><span class="p">:</span>
</span><span id="__span-4-204"><a id="__codelineno-4-204" name="__codelineno-4-204" href="#__codelineno-4-204"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">start</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.nsxt_tep.cidr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(1)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-205"><a id="__codelineno-4-205" name="__codelineno-4-205" href="#__codelineno-4-205"></a><span class="w">              </span><span class="nt">end</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.nsxt_tep.cidr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipaddr(&#39;-2&#39;)</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipaddr(&#39;address&#39;)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-206"><a id="__codelineno-4-206" name="__codelineno-4-206" href="#__codelineno-4-206"></a><span class="w">          </span><span class="nt">cidr</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.nsxt_tep.cidr</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-207"><a id="__codelineno-4-207" name="__codelineno-4-207" href="#__codelineno-4-207"></a><span class="w">          </span><span class="nt">do_wait_till_create</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-208"><a id="__codelineno-4-208" name="__codelineno-4-208" href="#__codelineno-4-208"></a>
</span><span id="__span-4-209"><a id="__codelineno-4-209" name="__codelineno-4-209" href="#__codelineno-4-209"></a><span class="w">  </span><span class="nt">uplink_profiles</span><span class="p">:</span>
</span><span id="__span-4-210"><a id="__codelineno-4-210" name="__codelineno-4-210" href="#__codelineno-4-210"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host-tep-profile</span>
</span><span id="__span-4-211"><a id="__codelineno-4-211" name="__codelineno-4-211" href="#__codelineno-4-211"></a><span class="w">      </span><span class="nt">teaming</span><span class="p">:</span>
</span><span id="__span-4-212"><a id="__codelineno-4-212" name="__codelineno-4-212" href="#__codelineno-4-212"></a><span class="w">        </span><span class="nt">active_list</span><span class="p">:</span>
</span><span id="__span-4-213"><a id="__codelineno-4-213" name="__codelineno-4-213" href="#__codelineno-4-213"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uplink_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uplink-1&quot;</span>
</span><span id="__span-4-214"><a id="__codelineno-4-214" name="__codelineno-4-214" href="#__codelineno-4-214"></a><span class="w">            </span><span class="nt">uplink_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PNIC</span>
</span><span id="__span-4-215"><a id="__codelineno-4-215" name="__codelineno-4-215" href="#__codelineno-4-215"></a><span class="w">        </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FAILOVER_ORDER</span>
</span><span id="__span-4-216"><a id="__codelineno-4-216" name="__codelineno-4-216" href="#__codelineno-4-216"></a><span class="w">      </span><span class="nt">transport_vlan</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.nsxt_tep.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-217"><a id="__codelineno-4-217" name="__codelineno-4-217" href="#__codelineno-4-217"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-tep-profile</span>
</span><span id="__span-4-218"><a id="__codelineno-4-218" name="__codelineno-4-218" href="#__codelineno-4-218"></a><span class="w">      </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">9000</span>
</span><span id="__span-4-219"><a id="__codelineno-4-219" name="__codelineno-4-219" href="#__codelineno-4-219"></a><span class="w">      </span><span class="nt">teaming</span><span class="p">:</span>
</span><span id="__span-4-220"><a id="__codelineno-4-220" name="__codelineno-4-220" href="#__codelineno-4-220"></a><span class="w">        </span><span class="nt">active_list</span><span class="p">:</span>
</span><span id="__span-4-221"><a id="__codelineno-4-221" name="__codelineno-4-221" href="#__codelineno-4-221"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uplink_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uplink-1&quot;</span>
</span><span id="__span-4-222"><a id="__codelineno-4-222" name="__codelineno-4-222" href="#__codelineno-4-222"></a><span class="w">            </span><span class="nt">uplink_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PNIC</span>
</span><span id="__span-4-223"><a id="__codelineno-4-223" name="__codelineno-4-223" href="#__codelineno-4-223"></a><span class="w">        </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FAILOVER_ORDER</span>
</span><span id="__span-4-224"><a id="__codelineno-4-224" name="__codelineno-4-224" href="#__codelineno-4-224"></a><span class="w">      </span><span class="nt">transport_vlan</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.nsxt_tep.vlan_id</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-225"><a id="__codelineno-4-225" name="__codelineno-4-225" href="#__codelineno-4-225"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-uplink-profile</span>
</span><span id="__span-4-226"><a id="__codelineno-4-226" name="__codelineno-4-226" href="#__codelineno-4-226"></a><span class="w">      </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1500</span>
</span><span id="__span-4-227"><a id="__codelineno-4-227" name="__codelineno-4-227" href="#__codelineno-4-227"></a><span class="w">      </span><span class="nt">teaming</span><span class="p">:</span>
</span><span id="__span-4-228"><a id="__codelineno-4-228" name="__codelineno-4-228" href="#__codelineno-4-228"></a><span class="w">        </span><span class="nt">active_list</span><span class="p">:</span>
</span><span id="__span-4-229"><a id="__codelineno-4-229" name="__codelineno-4-229" href="#__codelineno-4-229"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uplink_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uplink-1&quot;</span>
</span><span id="__span-4-230"><a id="__codelineno-4-230" name="__codelineno-4-230" href="#__codelineno-4-230"></a><span class="w">            </span><span class="nt">uplink_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PNIC</span>
</span><span id="__span-4-231"><a id="__codelineno-4-231" name="__codelineno-4-231" href="#__codelineno-4-231"></a><span class="w">        </span><span class="nt">policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">FAILOVER_ORDER</span>
</span><span id="__span-4-232"><a id="__codelineno-4-232" name="__codelineno-4-232" href="#__codelineno-4-232"></a><span class="w">      </span><span class="nt">transport_vlan</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">0</span>
</span><span id="__span-4-233"><a id="__codelineno-4-233" name="__codelineno-4-233" href="#__codelineno-4-233"></a>
</span><span id="__span-4-234"><a id="__codelineno-4-234" name="__codelineno-4-234" href="#__codelineno-4-234"></a><span class="w">  </span><span class="nt">transport_zones</span><span class="p">:</span>
</span><span id="__span-4-235"><a id="__codelineno-4-235" name="__codelineno-4-235" href="#__codelineno-4-235"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tz-overlay</span>
</span><span id="__span-4-236"><a id="__codelineno-4-236" name="__codelineno-4-236" href="#__codelineno-4-236"></a><span class="w">      </span><span class="nt">transport_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OVERLAY</span>
</span><span id="__span-4-237"><a id="__codelineno-4-237" name="__codelineno-4-237" href="#__codelineno-4-237"></a><span class="w">      </span><span class="c1"># host_switch_name: &quot;{{ distributed_switches[0].vds_name }}&quot;</span>
</span><span id="__span-4-238"><a id="__codelineno-4-238" name="__codelineno-4-238" href="#__codelineno-4-238"></a><span class="w">      </span><span class="nt">nested_nsx</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span><span class="w">  </span><span class="c1"># Set this to true if you use NSX-T for your physical host networking</span>
</span><span id="__span-4-239"><a id="__codelineno-4-239" name="__codelineno-4-239" href="#__codelineno-4-239"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Overlay</span><span class="nv"> </span><span class="s">Transport</span><span class="nv"> </span><span class="s">Zone&quot;</span>
</span><span id="__span-4-240"><a id="__codelineno-4-240" name="__codelineno-4-240" href="#__codelineno-4-240"></a><span class="w">      </span><span class="c1"># - display_name: nsx-vlan-transportzone</span>
</span><span id="__span-4-241"><a id="__codelineno-4-241" name="__codelineno-4-241" href="#__codelineno-4-241"></a><span class="w">      </span><span class="c1">#   transport_type: VLAN</span>
</span><span id="__span-4-242"><a id="__codelineno-4-242" name="__codelineno-4-242" href="#__codelineno-4-242"></a><span class="w">      </span><span class="c1">#   # host_switch_name: sw_vlan</span>
</span><span id="__span-4-243"><a id="__codelineno-4-243" name="__codelineno-4-243" href="#__codelineno-4-243"></a><span class="w">      </span><span class="c1">#   description: &quot;Uplink Transport Zone&quot;</span>
</span><span id="__span-4-244"><a id="__codelineno-4-244" name="__codelineno-4-244" href="#__codelineno-4-244"></a>
</span><span id="__span-4-245"><a id="__codelineno-4-245" name="__codelineno-4-245" href="#__codelineno-4-245"></a><span class="w">  </span><span class="nt">transport_node_profiles</span><span class="p">:</span>
</span><span id="__span-4-246"><a id="__codelineno-4-246" name="__codelineno-4-246" href="#__codelineno-4-246"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tnp1</span>
</span><span id="__span-4-247"><a id="__codelineno-4-247" name="__codelineno-4-247" href="#__codelineno-4-247"></a><span class="w">      </span><span class="nt">host_switches</span><span class="p">:</span>
</span><span id="__span-4-248"><a id="__codelineno-4-248" name="__codelineno-4-248" href="#__codelineno-4-248"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host_switch_profiles</span><span class="p">:</span>
</span><span id="__span-4-249"><a id="__codelineno-4-249" name="__codelineno-4-249" href="#__codelineno-4-249"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">host-tep-profile</span>
</span><span id="__span-4-250"><a id="__codelineno-4-250" name="__codelineno-4-250" href="#__codelineno-4-250"></a><span class="w">              </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">UplinkHostSwitchProfile</span>
</span><span id="__span-4-251"><a id="__codelineno-4-251" name="__codelineno-4-251" href="#__codelineno-4-251"></a><span class="w">          </span><span class="nt">host_switch_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">distributed_switches[0].vds_name</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-252"><a id="__codelineno-4-252" name="__codelineno-4-252" href="#__codelineno-4-252"></a><span class="w">          </span><span class="nt">host_switch_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VDS</span>
</span><span id="__span-4-253"><a id="__codelineno-4-253" name="__codelineno-4-253" href="#__codelineno-4-253"></a><span class="w">          </span><span class="nt">host_switch_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">STANDARD</span>
</span><span id="__span-4-254"><a id="__codelineno-4-254" name="__codelineno-4-254" href="#__codelineno-4-254"></a><span class="w">          </span><span class="nt">ip_assignment_spec</span><span class="p">:</span>
</span><span id="__span-4-255"><a id="__codelineno-4-255" name="__codelineno-4-255" href="#__codelineno-4-255"></a><span class="w">            </span><span class="nt">resource_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StaticIpPoolSpec</span>
</span><span id="__span-4-256"><a id="__codelineno-4-256" name="__codelineno-4-256" href="#__codelineno-4-256"></a><span class="w">            </span><span class="nt">ip_pool_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tep-pool&quot;</span>
</span><span id="__span-4-257"><a id="__codelineno-4-257" name="__codelineno-4-257" href="#__codelineno-4-257"></a><span class="w">          </span><span class="nt">transport_zone_endpoints</span><span class="p">:</span>
</span><span id="__span-4-258"><a id="__codelineno-4-258" name="__codelineno-4-258" href="#__codelineno-4-258"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_zone_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tz-overlay&quot;</span>
</span><span id="__span-4-259"><a id="__codelineno-4-259" name="__codelineno-4-259" href="#__codelineno-4-259"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_zone_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nsx-vlan-transportzone&quot;</span>
</span><span id="__span-4-260"><a id="__codelineno-4-260" name="__codelineno-4-260" href="#__codelineno-4-260"></a><span class="w">          </span><span class="nt">uplinks</span><span class="p">:</span>
</span><span id="__span-4-261"><a id="__codelineno-4-261" name="__codelineno-4-261" href="#__codelineno-4-261"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">uplink_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;uplink-1&quot;</span>
</span><span id="__span-4-262"><a id="__codelineno-4-262" name="__codelineno-4-262" href="#__codelineno-4-262"></a><span class="w">              </span><span class="nt">vds_uplink_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Uplink</span><span class="nv"> </span><span class="s">1&quot;</span>
</span><span id="__span-4-263"><a id="__codelineno-4-263" name="__codelineno-4-263" href="#__codelineno-4-263"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Cluster</span><span class="nv"> </span><span class="s">node</span><span class="nv"> </span><span class="s">profile&quot;</span>
</span><span id="__span-4-264"><a id="__codelineno-4-264" name="__codelineno-4-264" href="#__codelineno-4-264"></a>
</span><span id="__span-4-265"><a id="__codelineno-4-265" name="__codelineno-4-265" href="#__codelineno-4-265"></a><span class="w">  </span><span class="nt">cluster_attach</span><span class="p">:</span>
</span><span id="__span-4-266"><a id="__codelineno-4-266" name="__codelineno-4-266" href="#__codelineno-4-266"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tnc1&quot;</span>
</span><span id="__span-4-267"><a id="__codelineno-4-267" name="__codelineno-4-267" href="#__codelineno-4-267"></a><span class="w">      </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Transport</span><span class="nv"> </span><span class="s">Node</span><span class="nv"> </span><span class="s">Collections</span><span class="nv"> </span><span class="s">1&quot;</span>
</span><span id="__span-4-268"><a id="__codelineno-4-268" name="__codelineno-4-268" href="#__codelineno-4-268"></a><span class="w">      </span><span class="nt">compute_manager_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;vCenter&quot;</span>
</span><span id="__span-4-269"><a id="__codelineno-4-269" name="__codelineno-4-269" href="#__codelineno-4-269"></a><span class="w">      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;compute&quot;</span>
</span><span id="__span-4-270"><a id="__codelineno-4-270" name="__codelineno-4-270" href="#__codelineno-4-270"></a><span class="w">      </span><span class="nt">transport_node_profile_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tnp1&quot;</span>
</span><span id="__span-4-271"><a id="__codelineno-4-271" name="__codelineno-4-271" href="#__codelineno-4-271"></a>
</span><span id="__span-4-272"><a id="__codelineno-4-272" name="__codelineno-4-272" href="#__codelineno-4-272"></a><span class="w">  </span><span class="nt">edge_nodes</span><span class="p">:</span>
</span><span id="__span-4-273"><a id="__codelineno-4-273" name="__codelineno-4-273" href="#__codelineno-4-273"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-node-1</span>
</span><span id="__span-4-274"><a id="__codelineno-4-274" name="__codelineno-4-274" href="#__codelineno-4-274"></a><span class="w">      </span><span class="nt">size</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">MEDIUM</span>
</span><span id="__span-4-275"><a id="__codelineno-4-275" name="__codelineno-4-275" href="#__codelineno-4-275"></a><span class="w">      </span><span class="nt">mgmt_ip_address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(2)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-276"><a id="__codelineno-4-276" name="__codelineno-4-276" href="#__codelineno-4-276"></a><span class="w">      </span><span class="nt">mgmt_prefix_length</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.cidr.split(&#39;/&#39;)[1]</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-277"><a id="__codelineno-4-277" name="__codelineno-4-277" href="#__codelineno-4-277"></a><span class="w">      </span><span class="nt">mgmt_default_gateway</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.gateway</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-278"><a id="__codelineno-4-278" name="__codelineno-4-278" href="#__codelineno-4-278"></a><span class="w">      </span><span class="nt">network_management_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-network</span>
</span><span id="__span-4-279"><a id="__codelineno-4-279" name="__codelineno-4-279" href="#__codelineno-4-279"></a><span class="w">      </span><span class="nt">network_uplink_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">vm-network</span>
</span><span id="__span-4-280"><a id="__codelineno-4-280" name="__codelineno-4-280" href="#__codelineno-4-280"></a><span class="w">      </span><span class="nt">network_tep_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-tep-seg</span>
</span><span id="__span-4-281"><a id="__codelineno-4-281" name="__codelineno-4-281" href="#__codelineno-4-281"></a><span class="w">      </span><span class="nt">datastore_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">datastore-esx1</span>
</span><span id="__span-4-282"><a id="__codelineno-4-282" name="__codelineno-4-282" href="#__codelineno-4-282"></a><span class="w">      </span><span class="nt">cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">compute</span>
</span><span id="__span-4-283"><a id="__codelineno-4-283" name="__codelineno-4-283" href="#__codelineno-4-283"></a><span class="w">      </span><span class="nt">host_switches</span><span class="p">:</span>
</span><span id="__span-4-284"><a id="__codelineno-4-284" name="__codelineno-4-284" href="#__codelineno-4-284"></a><span class="w">        </span><span class="nt">tep</span><span class="p">:</span>
</span><span id="__span-4-285"><a id="__codelineno-4-285" name="__codelineno-4-285" href="#__codelineno-4-285"></a><span class="w">          </span><span class="nt">uplink_profile_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-tep-profile</span>
</span><span id="__span-4-286"><a id="__codelineno-4-286" name="__codelineno-4-286" href="#__codelineno-4-286"></a><span class="w">          </span><span class="nt">ip_assignment_spec</span><span class="p">:</span>
</span><span id="__span-4-287"><a id="__codelineno-4-287" name="__codelineno-4-287" href="#__codelineno-4-287"></a><span class="w">            </span><span class="nt">resource_type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StaticIpPoolSpec</span>
</span><span id="__span-4-288"><a id="__codelineno-4-288" name="__codelineno-4-288" href="#__codelineno-4-288"></a><span class="w">            </span><span class="nt">ip_pool_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tep-pool</span>
</span><span id="__span-4-289"><a id="__codelineno-4-289" name="__codelineno-4-289" href="#__codelineno-4-289"></a><span class="w">          </span><span class="nt">transport_zone_endpoints</span><span class="p">:</span>
</span><span id="__span-4-290"><a id="__codelineno-4-290" name="__codelineno-4-290" href="#__codelineno-4-290"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_zone_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tz-overlay&quot;</span>
</span><span id="__span-4-291"><a id="__codelineno-4-291" name="__codelineno-4-291" href="#__codelineno-4-291"></a><span class="w">        </span><span class="nt">uplink</span><span class="p">:</span>
</span><span id="__span-4-292"><a id="__codelineno-4-292" name="__codelineno-4-292" href="#__codelineno-4-292"></a><span class="w">          </span><span class="nt">host_switch_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;sw_vlan&quot;</span>
</span><span id="__span-4-293"><a id="__codelineno-4-293" name="__codelineno-4-293" href="#__codelineno-4-293"></a><span class="w">          </span><span class="nt">uplink_profile_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-uplink-profile</span>
</span><span id="__span-4-294"><a id="__codelineno-4-294" name="__codelineno-4-294" href="#__codelineno-4-294"></a><span class="w">          </span><span class="nt">transport_zone_endpoints</span><span class="p">:</span>
</span><span id="__span-4-295"><a id="__codelineno-4-295" name="__codelineno-4-295" href="#__codelineno-4-295"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_zone_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nsx-vlan-transportzone&quot;</span>
</span><span id="__span-4-296"><a id="__codelineno-4-296" name="__codelineno-4-296" href="#__codelineno-4-296"></a><span class="w">      </span><span class="nt">transport_zone_endpoints</span><span class="p">:</span>
</span><span id="__span-4-297"><a id="__codelineno-4-297" name="__codelineno-4-297" href="#__codelineno-4-297"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_zone_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tz-overlay-2&quot;</span>
</span><span id="__span-4-298"><a id="__codelineno-4-298" name="__codelineno-4-298" href="#__codelineno-4-298"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_zone_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nsx-vlan-transportzone&quot;</span>
</span><span id="__span-4-299"><a id="__codelineno-4-299" name="__codelineno-4-299" href="#__codelineno-4-299"></a>
</span><span id="__span-4-300"><a id="__codelineno-4-300" name="__codelineno-4-300" href="#__codelineno-4-300"></a><span class="w">  </span><span class="nt">edge_clusters</span><span class="p">:</span>
</span><span id="__span-4-301"><a id="__codelineno-4-301" name="__codelineno-4-301" href="#__codelineno-4-301"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">edge_cluster_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-cluster-1</span>
</span><span id="__span-4-302"><a id="__codelineno-4-302" name="__codelineno-4-302" href="#__codelineno-4-302"></a><span class="w">      </span><span class="nt">edge_cluster_members</span><span class="p">:</span>
</span><span id="__span-4-303"><a id="__codelineno-4-303" name="__codelineno-4-303" href="#__codelineno-4-303"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">transport_node_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-node-1</span>
</span><span id="__span-4-304"><a id="__codelineno-4-304" name="__codelineno-4-304" href="#__codelineno-4-304"></a>
</span><span id="__span-4-305"><a id="__codelineno-4-305" name="__codelineno-4-305" href="#__codelineno-4-305"></a><span class="w">  </span><span class="nt">vlan_segments</span><span class="p">:</span>
</span><span id="__span-4-306"><a id="__codelineno-4-306" name="__codelineno-4-306" href="#__codelineno-4-306"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">t0-uplink</span>
</span><span id="__span-4-307"><a id="__codelineno-4-307" name="__codelineno-4-307" href="#__codelineno-4-307"></a><span class="w">      </span><span class="nt">vlan_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-308"><a id="__codelineno-4-308" name="__codelineno-4-308" href="#__codelineno-4-308"></a><span class="w">      </span><span class="nt">transport_zone_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsx-vlan-transportzone</span>
</span><span id="__span-4-309"><a id="__codelineno-4-309" name="__codelineno-4-309" href="#__codelineno-4-309"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-tep-seg</span>
</span><span id="__span-4-310"><a id="__codelineno-4-310" name="__codelineno-4-310" href="#__codelineno-4-310"></a><span class="w">      </span><span class="nt">vlan_ids</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="nv">0</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-311"><a id="__codelineno-4-311" name="__codelineno-4-311" href="#__codelineno-4-311"></a><span class="w">      </span><span class="nt">transport_zone_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nsx-vlan-transportzone</span>
</span><span id="__span-4-312"><a id="__codelineno-4-312" name="__codelineno-4-312" href="#__codelineno-4-312"></a>
</span><span id="__span-4-313"><a id="__codelineno-4-313" name="__codelineno-4-313" href="#__codelineno-4-313"></a><span class="w">  </span><span class="c1"># For full spec see - https://github.com/laidbackware/ansible-for-nsxt/blob/vmware-lab-builder/library/nsxt_policy_tier0.py</span>
</span><span id="__span-4-314"><a id="__codelineno-4-314" name="__codelineno-4-314" href="#__codelineno-4-314"></a><span class="w">  </span><span class="nt">tier_0</span><span class="p">:</span>
</span><span id="__span-4-315"><a id="__codelineno-4-315" name="__codelineno-4-315" href="#__codelineno-4-315"></a><span class="w">    </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tkgs-t0&quot;</span>
</span><span id="__span-4-316"><a id="__codelineno-4-316" name="__codelineno-4-316" href="#__codelineno-4-316"></a><span class="w">    </span><span class="nt">ha_mode</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ACTIVE_STANDBY</span>
</span><span id="__span-4-317"><a id="__codelineno-4-317" name="__codelineno-4-317" href="#__codelineno-4-317"></a><span class="w">    </span><span class="nt">uplink_ip</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(3)</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-318"><a id="__codelineno-4-318" name="__codelineno-4-318" href="#__codelineno-4-318"></a><span class="w">    </span><span class="nt">disable_firewall</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-4-319"><a id="__codelineno-4-319" name="__codelineno-4-319" href="#__codelineno-4-319"></a><span class="w">    </span><span class="nt">static_routes</span><span class="p">:</span>
</span><span id="__span-4-320"><a id="__codelineno-4-320" name="__codelineno-4-320" href="#__codelineno-4-320"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-4-321"><a id="__codelineno-4-321" name="__codelineno-4-321" href="#__codelineno-4-321"></a><span class="w">        </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-route</span>
</span><span id="__span-4-322"><a id="__codelineno-4-322" name="__codelineno-4-322" href="#__codelineno-4-322"></a><span class="w">        </span><span class="nt">network</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0.0.0.0/0&quot;</span>
</span><span id="__span-4-323"><a id="__codelineno-4-323" name="__codelineno-4-323" href="#__codelineno-4-323"></a><span class="w">        </span><span class="nt">next_hops</span><span class="p">:</span>
</span><span id="__span-4-324"><a id="__codelineno-4-324" name="__codelineno-4-324" href="#__codelineno-4-324"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ip_address</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.gateway</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-325"><a id="__codelineno-4-325" name="__codelineno-4-325" href="#__codelineno-4-325"></a><span class="w">    </span><span class="nt">locale_services</span><span class="p">:</span>
</span><span id="__span-4-326"><a id="__codelineno-4-326" name="__codelineno-4-326" href="#__codelineno-4-326"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-4-327"><a id="__codelineno-4-327" name="__codelineno-4-327" href="#__codelineno-4-327"></a><span class="w">        </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;tkgs-t0-ls&quot;</span>
</span><span id="__span-4-328"><a id="__codelineno-4-328" name="__codelineno-4-328" href="#__codelineno-4-328"></a><span class="w">        </span><span class="nt">edge_cluster_info</span><span class="p">:</span>
</span><span id="__span-4-329"><a id="__codelineno-4-329" name="__codelineno-4-329" href="#__codelineno-4-329"></a><span class="w">          </span><span class="nt">edge_cluster_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-cluster-1</span>
</span><span id="__span-4-330"><a id="__codelineno-4-330" name="__codelineno-4-330" href="#__codelineno-4-330"></a><span class="w">        </span><span class="nt">interfaces</span><span class="p">:</span>
</span><span id="__span-4-331"><a id="__codelineno-4-331" name="__codelineno-4-331" href="#__codelineno-4-331"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;test-t0-t0ls-iface&quot;</span>
</span><span id="__span-4-332"><a id="__codelineno-4-332" name="__codelineno-4-332" href="#__codelineno-4-332"></a><span class="w">            </span><span class="nt">state</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">present</span>
</span><span id="__span-4-333"><a id="__codelineno-4-333" name="__codelineno-4-333" href="#__codelineno-4-333"></a><span class="w">            </span><span class="nt">subnets</span><span class="p">:</span>
</span><span id="__span-4-334"><a id="__codelineno-4-334" name="__codelineno-4-334" href="#__codelineno-4-334"></a><span class="w">              </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">ip_addresses</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.starting_addr</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">ansible.utils.ipmath(3)</span><span class="nv"> </span><span class="s">}}&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-4-335"><a id="__codelineno-4-335" name="__codelineno-4-335" href="#__codelineno-4-335"></a><span class="w">                </span><span class="nt">prefix_len</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;{{</span><span class="nv"> </span><span class="s">opinionated.hosting_network.base.cidr.split(&#39;/&#39;)[1]</span><span class="nv"> </span><span class="s">|</span><span class="nv"> </span><span class="s">int</span><span class="nv"> </span><span class="s">}}&quot;</span>
</span><span id="__span-4-336"><a id="__codelineno-4-336" name="__codelineno-4-336" href="#__codelineno-4-336"></a><span class="w">            </span><span class="nt">segment_id</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">t0-uplink</span>
</span><span id="__span-4-337"><a id="__codelineno-4-337" name="__codelineno-4-337" href="#__codelineno-4-337"></a><span class="w">            </span><span class="nt">edge_node_info</span><span class="p">:</span>
</span><span id="__span-4-338"><a id="__codelineno-4-338" name="__codelineno-4-338" href="#__codelineno-4-338"></a><span class="w">              </span><span class="nt">edge_cluster_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-cluster-1</span>
</span><span id="__span-4-339"><a id="__codelineno-4-339" name="__codelineno-4-339" href="#__codelineno-4-339"></a><span class="w">              </span><span class="nt">edge_node_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">edge-node-1</span>
</span><span id="__span-4-340"><a id="__codelineno-4-340" name="__codelineno-4-340" href="#__codelineno-4-340"></a><span class="w">            </span><span class="nt">mtu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1500</span>
</span><span id="__span-4-341"><a id="__codelineno-4-341" name="__codelineno-4-341" href="#__codelineno-4-341"></a>
</span><span id="__span-4-342"><a id="__codelineno-4-342" name="__codelineno-4-342" href="#__codelineno-4-342"></a><span class="w">  </span><span class="nt">overlay_segments</span><span class="p">:</span>
</span><span id="__span-4-343"><a id="__codelineno-4-343" name="__codelineno-4-343" href="#__codelineno-4-343"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">supervisor-seg</span>
</span><span id="__span-4-344"><a id="__codelineno-4-344" name="__codelineno-4-344" href="#__codelineno-4-344"></a><span class="w">      </span><span class="nt">transport_zone_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tz-overlay</span>
</span><span id="__span-4-345"><a id="__codelineno-4-345" name="__codelineno-4-345" href="#__codelineno-4-345"></a><span class="w">      </span><span class="nt">tier1_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">supervisor-t1</span>
</span><span id="__span-4-346"><a id="__codelineno-4-346" name="__codelineno-4-346" href="#__codelineno-4-346"></a><span class="w">      </span><span class="nt">subnets</span><span class="p">:</span>
</span><span id="__span-4-347"><a id="__codelineno-4-347" name="__codelineno-4-347" href="#__codelineno-4-347"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">gateway_address</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">&gt;-</span>
</span><span id="__span-4-348"><a id="__codelineno-4-348" name="__codelineno-4-348" href="#__codelineno-4-348"></a><span class="w">            </span><span class="no">{{ opinionated.tanzu_vsphere.routeable_super_net |</span>
</span><span id="__span-4-349"><a id="__codelineno-4-349" name="__codelineno-4-349" href="#__codelineno-4-349"></a><span class="w">            </span><span class="no">ansible.utils.ipmath(1) }}/{{ opinionated.tanzu_vsphere.routeable_super_net.split(&#39;/&#39;)[1] |int +3 }}</span>
</span><span id="__span-4-350"><a id="__codelineno-4-350" name="__codelineno-4-350" href="#__codelineno-4-350"></a>
</span><span id="__span-4-351"><a id="__codelineno-4-351" name="__codelineno-4-351" href="#__codelineno-4-351"></a><span class="w">  </span><span class="nt">tier_1_gateways</span><span class="p">:</span>
</span><span id="__span-4-352"><a id="__codelineno-4-352" name="__codelineno-4-352" href="#__codelineno-4-352"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">supervisor-t1</span>
</span><span id="__span-4-353"><a id="__codelineno-4-353" name="__codelineno-4-353" href="#__codelineno-4-353"></a><span class="w">      </span><span class="nt">route_advertisement_types</span><span class="p">:</span>
</span><span id="__span-4-354"><a id="__codelineno-4-354" name="__codelineno-4-354" href="#__codelineno-4-354"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="s">&quot;TIER1_CONNECTED&quot;</span>
</span><span id="__span-4-355"><a id="__codelineno-4-355" name="__codelineno-4-355" href="#__codelineno-4-355"></a><span class="w">      </span><span class="nt">tier0_display_name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tkgs-t0</span>
</span></code></pre></div>
<h2 id="restrict-internet-access-in-vyos-interfaces">Restrict internet access in VyOS interfaces</h2>
<p>We will create an environment that doesn't have outbound internet connection but ingress connection from the internet is allowed and also all traffic within the network is allowed. We don't restrict internal communications on a per-port level.</p>
<ol>
<li>
<p>Create a <code>Firewall address-group</code> called <code>ALLOWED-IPS</code> that will collect all IP ranges to and from which communication is allowed using the command</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#__codelineno-5-1"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>group<span class="w"> </span>address-group<span class="w"> </span>ALLOWED-IPS<span class="w"> </span>address<span class="w"> </span><span class="m">172</span>.20.16.1-172.20.16.255
</span></code></pre></div>
<p>Do this for every IP range you are using (don't forget the internal Kubernetes pod and service range). We get the following result:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#__codelineno-6-1"></a>vyos@vyos#<span class="w"> </span>show<span class="w"> </span>firewall<span class="w"> </span>group
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#__codelineno-6-2"></a>address-group<span class="w"> </span>ALLOWED-IPS<span class="w"> </span><span class="o">{</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#__codelineno-6-3"></a><span class="w">    </span>address<span class="w"> </span><span class="m">192</span>.168.178.1-192.168.178.255
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#__codelineno-6-4"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.16.1-172.20.16.255
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#__codelineno-6-5"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.17.1-172.20.17.255
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#__codelineno-6-6"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.18.1-172.20.18.255
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#__codelineno-6-7"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.19.1-172.20.19.255
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#__codelineno-6-8"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.20.1-172.20.20.255
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#__codelineno-6-9"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.21.1-172.20.21.255
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#__codelineno-6-10"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.22.1-172.20.22.255
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#__codelineno-6-11"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.23.1-172.20.23.255
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#__codelineno-6-12"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.30.4.1-172.30.4.255
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#__codelineno-6-13"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.0.1-172.32.0.255
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#__codelineno-6-14"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.1.1-172.32.1.255
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#__codelineno-6-15"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.2.1-172.32.2.255
</span><span id="__span-6-16"><a id="__codelineno-6-16" name="__codelineno-6-16" href="#__codelineno-6-16"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.3.1-172.32.3.255
</span><span id="__span-6-17"><a id="__codelineno-6-17" name="__codelineno-6-17" href="#__codelineno-6-17"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.4.1-172.32.4.255
</span><span id="__span-6-18"><a id="__codelineno-6-18" name="__codelineno-6-18" href="#__codelineno-6-18"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.5.1-172.32.5.255
</span><span id="__span-6-19"><a id="__codelineno-6-19" name="__codelineno-6-19" href="#__codelineno-6-19"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.6.1-172.32.6.255
</span><span id="__span-6-20"><a id="__codelineno-6-20" name="__codelineno-6-20" href="#__codelineno-6-20"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.32.7.1-172.32.7.255
</span><span id="__span-6-21"><a id="__codelineno-6-21" name="__codelineno-6-21" href="#__codelineno-6-21"></a><span class="o">}</span>
</span></code></pre></div>
</li>
<li>
<p>Create a firewall rule to allow inbound traffic from everywhere</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#__codelineno-7-1"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL<span class="w"> </span>default-action<span class="w"> </span>drop
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#__codelineno-7-2"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL<span class="w"> </span>description<span class="w"> </span><span class="s2">&quot;Allow all incoming connections&quot;</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#__codelineno-7-3"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL<span class="w"> </span>enable-default-log
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#__codelineno-7-4"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>action<span class="w"> </span>accept
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#__codelineno-7-5"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>log<span class="w"> </span><span class="nb">enable</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#__codelineno-7-6"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>address<span class="w"> </span><span class="m">0</span>.0.0.0/0
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#__codelineno-7-7"></a>commit<span class="w"> </span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#__codelineno-7-8"></a>save
</span></code></pre></div>
<p>The result is:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#__codelineno-8-1"></a>vyos@vyos#<span class="w"> </span>show<span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>INBOUND-ALL
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#__codelineno-8-2"></a>default-action<span class="w"> </span>drop
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#__codelineno-8-3"></a>description<span class="w"> </span><span class="s2">&quot;Allow all incoming connections&quot;</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#__codelineno-8-4"></a>enable-default-log
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#__codelineno-8-5"></a>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#__codelineno-8-6"></a><span class="w">    </span>action<span class="w"> </span>accept
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#__codelineno-8-7"></a><span class="w">    </span>log<span class="w"> </span><span class="nb">enable</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#__codelineno-8-8"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#__codelineno-8-9"></a><span class="w">        </span>address<span class="w"> </span><span class="m">0</span>.0.0.0/0
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#__codelineno-8-10"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#__codelineno-8-11"></a><span class="o">}</span>
</span></code></pre></div>
</li>
<li>
<p>Create a firewall rule for outbound communication</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#__codelineno-9-1"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>default-action<span class="w"> </span><span class="s1">&#39;drop&#39;</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#__codelineno-9-2"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>description<span class="w"> </span><span class="s1">&#39;Restrict outbound connections&#39;</span>
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#__codelineno-9-3"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>enable-default-log
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#__codelineno-9-4"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">10</span><span class="w"> </span>action<span class="w"> </span><span class="s1">&#39;accept&#39;</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#__codelineno-9-5"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">10</span><span class="w"> </span>description<span class="w"> </span><span class="s1">&#39;Allow DNS&#39;</span>
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#__codelineno-9-6"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">10</span><span class="w"> </span>destination<span class="w"> </span>port<span class="w"> </span><span class="s1">&#39;53&#39;</span>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#__codelineno-9-7"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">10</span><span class="w"> </span>protocol<span class="w"> </span><span class="s1">&#39;tcp_udp&#39;</span>
</span><span id="__span-9-8"><a id="__codelineno-9-8" name="__codelineno-9-8" href="#__codelineno-9-8"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>action<span class="w"> </span><span class="s1">&#39;accept&#39;</span>
</span><span id="__span-9-9"><a id="__codelineno-9-9" name="__codelineno-9-9" href="#__codelineno-9-9"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>description<span class="w"> </span><span class="s1">&#39;Allow SSH&#39;</span>
</span><span id="__span-9-10"><a id="__codelineno-9-10" name="__codelineno-9-10" href="#__codelineno-9-10"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>destination<span class="w"> </span>port<span class="w"> </span><span class="s1">&#39;22&#39;</span>
</span><span id="__span-9-11"><a id="__codelineno-9-11" name="__codelineno-9-11" href="#__codelineno-9-11"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>log<span class="w"> </span><span class="s1">&#39;enable&#39;</span>
</span><span id="__span-9-12"><a id="__codelineno-9-12" name="__codelineno-9-12" href="#__codelineno-9-12"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span>protocol<span class="w"> </span><span class="s1">&#39;tcp&#39;</span>
</span><span id="__span-9-13"><a id="__codelineno-9-13" name="__codelineno-9-13" href="#__codelineno-9-13"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">30</span><span class="w"> </span>action<span class="w"> </span><span class="s1">&#39;accept&#39;</span>
</span><span id="__span-9-14"><a id="__codelineno-9-14" name="__codelineno-9-14" href="#__codelineno-9-14"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">30</span><span class="w"> </span>description<span class="w"> </span><span class="s1">&#39;Allow specific outbound traffic&#39;</span>
</span><span id="__span-9-15"><a id="__codelineno-9-15" name="__codelineno-9-15" href="#__codelineno-9-15"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">30</span><span class="w"> </span>log<span class="w"> </span><span class="s1">&#39;enable&#39;</span>
</span><span id="__span-9-16"><a id="__codelineno-9-16" name="__codelineno-9-16" href="#__codelineno-9-16"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">30</span><span class="w"> </span>protocol<span class="w"> </span><span class="s1">&#39;all&#39;</span>
</span><span id="__span-9-17"><a id="__codelineno-9-17" name="__codelineno-9-17" href="#__codelineno-9-17"></a><span class="nb">set</span><span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT<span class="w"> </span>rule<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="nb">source</span><span class="w"> </span>group<span class="w"> </span>address-group<span class="w"> </span><span class="s1">&#39;ALLOWED-IPS&#39;</span>
</span><span id="__span-9-18"><a id="__codelineno-9-18" name="__codelineno-9-18" href="#__codelineno-9-18"></a>commit<span class="w"> </span>
</span><span id="__span-9-19"><a id="__codelineno-9-19" name="__codelineno-9-19" href="#__codelineno-9-19"></a>save
</span></code></pre></div>
<p>The result is:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#__codelineno-10-1"></a>vyos@vyos#<span class="w"> </span>show<span class="w"> </span>firewall<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#__codelineno-10-2"></a>default-action<span class="w"> </span>drop
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#__codelineno-10-3"></a>description<span class="w"> </span><span class="s2">&quot;Restrict outbound connections&quot;</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#__codelineno-10-4"></a>enable-default-log
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#__codelineno-10-5"></a>rule<span class="w"> </span><span class="m">10</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#__codelineno-10-6"></a><span class="w">    </span>action<span class="w"> </span>accept
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#__codelineno-10-7"></a><span class="w">    </span>description<span class="w"> </span><span class="s2">&quot;Allow DNS&quot;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#__codelineno-10-8"></a><span class="w">    </span>destination<span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#__codelineno-10-9"></a><span class="w">        </span>port<span class="w"> </span><span class="m">53</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#__codelineno-10-10"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#__codelineno-10-11"></a><span class="w">    </span>protocol<span class="w"> </span>tcp_udp
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#__codelineno-10-12"></a><span class="o">}</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#__codelineno-10-13"></a>rule<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#__codelineno-10-14"></a><span class="w">    </span>action<span class="w"> </span>accept
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#__codelineno-10-15"></a><span class="w">    </span>description<span class="w"> </span><span class="s2">&quot;Allow SSH&quot;</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#__codelineno-10-16"></a><span class="w">    </span>destination<span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#__codelineno-10-17"></a><span class="w">        </span>port<span class="w"> </span><span class="m">22</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#__codelineno-10-18"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#__codelineno-10-19"></a><span class="w">    </span>log<span class="w"> </span><span class="nb">enable</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#__codelineno-10-20"></a><span class="w">    </span>protocol<span class="w"> </span>tcp
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#__codelineno-10-21"></a><span class="o">}</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#__codelineno-10-22"></a>rule<span class="w"> </span><span class="m">30</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#__codelineno-10-23"></a><span class="w">    </span>action<span class="w"> </span>accept
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#__codelineno-10-24"></a><span class="w">    </span>description<span class="w"> </span><span class="s2">&quot;Allow specific outbound traffic&quot;</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#__codelineno-10-25"></a><span class="w">    </span>log<span class="w"> </span><span class="nb">enable</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#__codelineno-10-26"></a><span class="w">    </span>protocol<span class="w"> </span>all
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#__codelineno-10-27"></a><span class="w">    </span><span class="nb">source</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#__codelineno-10-28"></a><span class="w">        </span>group<span class="w"> </span><span class="o">{</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#__codelineno-10-29"></a><span class="w">            </span>address-group<span class="w"> </span>ALLOWED-IPS
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#__codelineno-10-30"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#__codelineno-10-31"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#__codelineno-10-32"></a><span class="o">}</span>
</span></code></pre></div>
</li>
<li>
<p>Finally, apply the firewall rules on the respective interfaces:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#__codelineno-11-1"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span>firewall<span class="w"> </span><span class="k">in</span><span class="w"> </span>name<span class="w"> </span>INBOUND-ALL
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#__codelineno-11-2"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span>firewall<span class="w"> </span>out<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#__codelineno-11-3"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span>firewall<span class="w"> </span><span class="k">in</span><span class="w"> </span>name<span class="w"> </span>INBOUND-ALL
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#__codelineno-11-4"></a><span class="nb">set</span><span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1<span class="w"> </span>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span>firewall<span class="w"> </span>out<span class="w"> </span>name<span class="w"> </span>OUTBOUND-RESTRICT
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#__codelineno-11-5"></a>commit
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#__codelineno-11-6"></a>save
</span></code></pre></div>
<p>The result is:</p>
<div class="language-shell highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#__codelineno-12-1"></a>vyos@vyos#<span class="w"> </span>show<span class="w"> </span>interfaces<span class="w"> </span>ethernet<span class="w"> </span>eth1
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#__codelineno-12-2"></a>hw-id<span class="w"> </span><span class="m">00</span>:0c:29:85:a5:45
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#__codelineno-12-3"></a>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#__codelineno-12-4"></a>vif<span class="w"> </span><span class="m">16</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#__codelineno-12-5"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.16.1/22
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#__codelineno-12-6"></a><span class="w">    </span>description<span class="w"> </span>tanzu-without-dhcp
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#__codelineno-12-7"></a><span class="w">    </span>firewall<span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#__codelineno-12-8"></a><span class="w">        </span><span class="k">in</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#__codelineno-12-9"></a><span class="w">            </span>name<span class="w"> </span>INBOUND-ALL
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#__codelineno-12-10"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#__codelineno-12-11"></a><span class="w">        </span>out<span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#__codelineno-12-12"></a><span class="w">            </span>name<span class="w"> </span>OUTBOUND-RESTRICT
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#__codelineno-12-13"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#__codelineno-12-14"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#__codelineno-12-15"></a><span class="w">    </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#__codelineno-12-16"></a><span class="o">}</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#__codelineno-12-17"></a>vif<span class="w"> </span><span class="m">20</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#__codelineno-12-18"></a><span class="w">    </span>address<span class="w"> </span><span class="m">172</span>.20.20.1/22
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#__codelineno-12-19"></a><span class="w">    </span>description<span class="w"> </span>nsxt-tep
</span><span id="__span-12-20"><a id="__codelineno-12-20" name="__codelineno-12-20" href="#__codelineno-12-20"></a><span class="w">    </span>firewall<span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-21"><a id="__codelineno-12-21" name="__codelineno-12-21" href="#__codelineno-12-21"></a><span class="w">        </span><span class="k">in</span><span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-22"><a id="__codelineno-12-22" name="__codelineno-12-22" href="#__codelineno-12-22"></a><span class="w">            </span>name<span class="w"> </span>INBOUND-ALL
</span><span id="__span-12-23"><a id="__codelineno-12-23" name="__codelineno-12-23" href="#__codelineno-12-23"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-12-24"><a id="__codelineno-12-24" name="__codelineno-12-24" href="#__codelineno-12-24"></a><span class="w">        </span>out<span class="w"> </span><span class="o">{</span>
</span><span id="__span-12-25"><a id="__codelineno-12-25" name="__codelineno-12-25" href="#__codelineno-12-25"></a><span class="w">            </span>name<span class="w"> </span>OUTBOUND-RESTRICT
</span><span id="__span-12-26"><a id="__codelineno-12-26" name="__codelineno-12-26" href="#__codelineno-12-26"></a><span class="w">        </span><span class="o">}</span>
</span><span id="__span-12-27"><a id="__codelineno-12-27" name="__codelineno-12-27" href="#__codelineno-12-27"></a><span class="w">    </span><span class="o">}</span>
</span><span id="__span-12-28"><a id="__codelineno-12-28" name="__codelineno-12-28" href="#__codelineno-12-28"></a><span class="w">    </span>mtu<span class="w"> </span><span class="m">9000</span>
</span><span id="__span-12-29"><a id="__codelineno-12-29" name="__codelineno-12-29" href="#__codelineno-12-29"></a><span class="o">}</span>
</span></code></pre></div>
</li>
</ol>







  
    
  
  


  <aside class="md-source-file">
    
      
  <span class="md-source-file__fact">
    <span class="md-icon" title="Last update">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M21 13.1c-.1 0-.3.1-.4.2l-1 1 2.1 2.1 1-1c.2-.2.2-.6 0-.8l-1.3-1.3c-.1-.1-.2-.2-.4-.2m-1.9 1.8-6.1 6V23h2.1l6.1-6.1-2.1-2M12.5 7v5.2l4 2.4-1 1L11 13V7h1.5M11 21.9c-5.1-.5-9-4.8-9-9.9C2 6.5 6.5 2 12 2c5.3 0 9.6 4.1 10 9.3-.3-.1-.6-.2-1-.2s-.7.1-1 .2C19.6 7.2 16.2 4 12 4c-4.4 0-8 3.6-8 8 0 4.1 3.1 7.5 7.1 7.9l-.1.2v1.8Z"/></svg>
    </span>
    <span class="git-revision-date-localized-plugin git-revision-date-localized-plugin-date">July 17, 2024</span>
  </span>

    
    
    
    
  </aside>


  




                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2024 Andreas Knapp  <a href="#__consent">Change cookie settings</a>

    </div>
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://github.com/Knappek" target="_blank" rel="noopener" title="github.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://linkedin.com/in/andy-knapp-6a72b6108" target="_blank" rel="noopener" title="linkedin.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
      <div class="md-consent" data-md-component="consent" id="__consent" hidden>
        <div class="md-consent__overlay"></div>
        <aside class="md-consent__inner">
          <form class="md-consent__form md-grid md-typeset" name="consent">
            

  


  



  


<h4>Cookie consent</h4>
<p>We use cookies to recognize your repeated visits and preferences, as well as to measure the effectiveness of our documentation and whether users find what they're searching for. With your consent, you're helping us to make our documentation better.</p>
<input class="md-toggle" type="checkbox" id="__settings" >
<div class="md-consent__settings">
  <ul class="task-list">
    
      
      
        
        
          
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="analytics" checked>
          <span class="task-list-indicator"></span>
          Google Analytics
        </label>
      </li>
    
      
      
        
        
      
      <li class="task-list-item">
        <label class="task-list-control">
          <input type="checkbox" name="github" checked>
          <span class="task-list-indicator"></span>
          GitHub
        </label>
      </li>
    
  </ul>
</div>
<div class="md-consent__controls">
  
    
      <button class="md-button md-button--primary">Accept</button>
    
    
    
  
    
    
    
      <label class="md-button" for="__settings">Manage settings</label>
    
  
</div>
          </form>
        </aside>
      </div>
      <script>var consent=__md_get("__consent");if(consent)for(var input of document.forms.consent.elements)input.name&&(input.checked=consent[input.name]||!1);else"file:"!==location.protocol&&setTimeout(function(){document.querySelector("[data-md-component=consent]").hidden=!1},250);var action,form=document.forms.consent;for(action of["submit","reset"])form.addEventListener(action,function(e){if(e.preventDefault(),"reset"===e.type)for(var n of document.forms.consent.elements)n.name&&(n.checked=!1);__md_set("__consent",Object.fromEntries(Array.from(new FormData(form).keys()).map(function(e){return[e,!0]}))),location.hash="",location.reload()})</script>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["content.code.annotate", "content.code.copy", "navigation.indexes", "navigation.instant", "navigation.tabs", "navigation.tabs.sticky", "search.suggest", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.ad660dcc.min.js"></script>
      
    
  <script id="init-glightbox">const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});
document$.subscribe(() => { lightbox.reload() });
</script></body>
</html>